#!/usr/bin/env bash

# Developed by Nalin Ahuja, nalinahuja22

# End Header---------------------------------------------------------------------------------------------------------------------------------------------------------

# Boolean Values
TRUE=1
FALSE=0

# Embedded Strings
YES="y"

# Install Files
QCD_FOLD=~/.qcd
QCD_HELP=./help
QCD_PROG=./qcd.sh
QCD_LICE=./LICENSE
QCD_READ=./README.md

# Bash Config Locations
BASHRC=~/.bashrc
BASHPR=~/.bash_profile

# End Defined Constants----------------------------------------------------------------------------------------------------------------------------------------------

status=${FALSE} is_update=${TRUE} version=$(command cat ${QCD_HELP} | command head -n1 | command awk '{print $4}')

# End Global Variables-----------------------------------------------------------------------------------------------------------------------------------------------

# Prompt User For Installation Confirmation
command read -p "Please confirm installation of QCD (${version}) [y/n]: " confirm

# Determine Action
if [[ "${confirm//Y/${YES}}" == ${YES} ]]
then
  # Add Command To Bash Profile
  if [[ ! -e ${QCD_FOLD} ]]
  then
    # Find
    if [[ -f ${BASHRC} ]]
    then
      # Add Command To ~/.bashrc
      command echo -e "\n# qcd Function (qcd [PATH|LINK] [OPTIONS])\n\nsource ~/.qcd/qcd.sh\n" >> ${BASHRC}

      # Set Status Boolean
      status=${TRUE}
    fi

    if [[ -f ${BASHPR} ]]
    then
      # Add Command To .bash_profile
      command echo -e "\n# qcd Function (qcd [PATH|LINK] [OPTIONS])\n\nsource ~/.qcd/qcd.sh\n" >> ${BASHPR}

      # Set Status Boolean
      status=${TRUE}
    fi

    if [[ ${status} -eq ${FALSE} ]]
    then
      # Display Error
      command echo -e "ERROR: Failed to install command to terminal profile. Installation aborted!"

      # Exit Installation
      command exit 1
    fi

    # Confirm Command Installation
    command echo -e "→ Installed QCD command to terminal configuration"

    # Set Update Boolean
    is_update=${FALSE}
  fi

  # Install QCD Program Files
  command mkdir ${QCD_FOLD} 2> /dev/null
  command mv ${QCD_PROG} ${QCD_FOLD} 2> /dev/null
  command mv ${QCD_HELP} ${QCD_FOLD} 2> /dev/null
  command mv ${QCD_LICE} ${QCD_FOLD} 2> /dev/null
  command mv ${QCD_READ} ${QCD_FOLD} 2> /dev/null

  # Determine Appropriate Message
  if [[ ${is_update} -eq ${TRUE} ]]
  then
    command echo -e "→ Upgraded QCD to ${version}"
  else
    command echo -e "→ Installed QCD ${version} into ~/.qcd"
  fi

  # Finish Installation
  command echo -e "\nPlease restart your terminal"
else
  # Abort Installation
  command echo -e "→ QCD installation aborted"
fi

# End QCD Installation------------------------------------------------------------------------------------------------------------------------------------------------
