#!/usr/bin/env bash

# Developed by Nalin Ahuja, nalinahuja22

# End Header-----------------------------------------------------------------------------------------------------------------------------------------------------------

# Boolean Values
declare TRUE=1 FALSE=0

# Embedded Strings
declare YES="y"

# Program Path
declare QCD_FOLD=~/.qcd

# Program Files
declare QCD_HELP=./help
declare QCD_PROG=./qcd.sh
declare CD_LICE=./LICENSE
declare QCD_READ=./README.md

# Bash Profiles
declare BASHRC=~/.bashrc
declare BASHPR=~/.bash_profile

# End Defined Constants------------------------------------------------------------------------------------------------------------------------------------------------

declare is_update=${TRUE} install_status=${FALSE} install_version=$(command cat ${QCD_HELP} | command head -n1 | command awk '{print $4}')

# End Global Variables-------------------------------------------------------------------------------------------------------------------------------------------------

# Prompt User For Installation Confirmation
command read -p "qcd: Please confirm installation of QCD (${install_version}) [y/n]: " confirm

# Determine Action
if [[ ${confirm//Y/${YES}} == ${YES} ]]
then
  # Add Command To Bash Profile
  if [[ ! -d ${QCD_FOLD} ]]
  then
    # Find ~/.bashrc
    if [[ -f ${BASHRC} ]]
    then
      # Add Command To ~/.bashrc
      command echo -e "\n# QCD Utility Source\ncommand source ~/.qcd/qcd.sh\n" >> ${BASHRC} && install_status=${TRUE}
    fi

    # Find ~/.bash_profile
    if [[ -f ${BASHPR} ]]
    then
      # Add Command To ~/.bash_profile
      command echo -e "\n# QCD Utility Source\ncommand source ~/.qcd/qcd.sh\n" >> ${BASHPR} && install_status=${TRUE}
    fi

    # Check Command Installation Status
    if [[ ${install_status} == ${FALSE} ]]
    then
      # Display Error Prompt
      command echo -e "→ No bash configurations found, aborting QCD installation"

      # Exit Installation
      command exit 1
    fi

    # Display Success Prompt
    command echo -e "→ Installed QCD command to terminal configuration" && is_update=${FALSE}
  fi

  # Install QCD Program Files
  command mkdir ${QCD_FOLD} 2> /dev/null
  command mv ${QCD_PROG} ${QCD_FOLD} 2> /dev/null
  command mv ${QCD_HELP} ${QCD_FOLD} 2> /dev/null
  command mv ${QCD_LICE} ${QCD_FOLD} 2> /dev/null
  command mv ${QCD_READ} ${QCD_FOLD} 2> /dev/null

  # Determine Appropriate Prompt
  if [[ ${is_update} == ${TRUE} ]]
  then
    # Display Upgrade Prompt
    command echo -e "→ Upgraded QCD to ${install_version}"
  else
    # Display Installation Prompt
    command echo -e "→ Installed QCD ${install_version}"
  fi

  # Display Success Prompt
  command echo -e "\nPlease restart your terminal"
else
  # Display Abort Prompt
  command echo -e "→ QCD installation aborted"
fi

# End QCD Installation-------------------------------------------------------------------------------------------------------------------------------------------------
