#!/usr/bin/env bash

#Developed by Nalin Ahuja, nalinahuja22

TRUE=1
FALSE=0

QCD_FOLD=~/.qcd
QCD_HELP=./help
QCD_PROG=./qcd.sh
QCD_LICE=./LICENSE
QCD_READ=./README.md

# End Defined Constants----------------------------------------------------------------------------------------------------------------------------------------------

upgrade=$TRUE
version=$(command cat $QCD_HELP | command head -n1 | command awk '{print $4}')

# End Global Variables-----------------------------------------------------------------------------------------------------------------------------------------------

# Prompt User For Confirmation
command read -p "Please Confirm Installation of QCD ($version) [y/n]: " confirm

# Process Input
if [ "$confirm" == y ] || [ "$confirm" == Y ]
then
  # Add Command To Bash Profile
  if [[ ! -e $QCD_FOLD ]]
  then
    if [[ -f ~/.bashrc ]]
    then
      # Add To .bashrc
      echo -e "\n# qcd Function (qcd [PATH/LINK] [OPTIONS])\n\nsource ~/.qcd/qcd.sh\n"  >> ~/.bashrc
    elif [[ -f ~/.bash_profile ]]
    then
      # Add To .bash_profile
      echo -e "\n# qcd Function (qcd [PATH/LINK] [OPTIONS])\n\nsource ~/.qcd/qcd.sh\n" >> ~/.bash_profile
    else
      # Throw An Error And Exit
      echo -e "ERROR: Failed to Install Command To Terminal Profile. Installation Aborted!"
      command exit 1
    fi

    # Confirm Command Installation
    echo -e "→ Installed QCD Command To Terminal Config"

    # Set Upgrade Indicator
    upgrade=$FALSE
  fi

  # Install QCD Program Files
  command mkdir $QCD_FOLD 2> /dev/null
  command mv $QCD_PROG $QCD_FOLD 2> /dev/null
  command mv $QCD_HELP $QCD_FOLD 2> /dev/null
  command mv $QCD_LICE $QCD_FOLD 2> /dev/null
  command mv $QCD_READ $QCD_FOLD 2> /dev/null

  # Update Bash Environment
  command source ~/.qcd/qcd.sh

  # Determine Appropriate Message
  if [[ $upgrade -eq $TRUE ]]
  then
    echo -e "→ Upgraded QCD To $version"
  else
    echo -e "→ Installed QCD $version In ~/.qcd"
  fi

  # Finish QCD Installation
  echo -e "\nPlease Restart Your Terminal"
elif [ "$confirm" == n ] || [ "$confirm" == N ]
then
  # Abort Installation
  echo -e "\nQCD Installation Aborted!"
else
  # Abort Installation
  echo -e "\nERROR: Invalid Input, Installation Aborted!"
fi

# End QCD Installation------------------------------------------------------------------------------------------------------------------------------------------------
